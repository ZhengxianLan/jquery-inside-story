## DOM 操作

上一章的遍历方法，jQuery 为我们模拟了 IE 9 以下不支持的元素节点相关的属性。这一章的 DOM 操作，要讲的很大一部分是 jQuery 为我们模拟的元素节点在 DOM4 中才被定义的 `after`、`before` 等方法。当然除此之外 jQuery 还做了大量的扩展。

### 插入元素

###### `domMapip(args,callback,allowIntersection)`

负责转换 HTML 为 DOM 元素，然后调用传入的回调函数插入 DOM 元素。它为 jQuery 的一系列插入方法提供了支持。

1. `args` 是待插入的内容。
 1. 如果是函数，那么执行函数，并为每个元素执行 `domMapip`，传入函数执行的结果。
 2. 如果当前浏览器无法正确地复制文档片段中的 `check` 状态，为每个元素调用 `domMapip`，这样执行回调函数插入元素时，因为只有一个元素，避免了无法复制 `check` 状态的问题。
2. 用第二章讲的 `jQuery.buildFragment` 将 HTML 转为 DOM 元素，返回安全文档片段。
3. 取出第一个子节点，如果只有一个子节点那么用它覆盖文档片段变量 `fragment`，因为直接插入子节点比插入文档片段要快一点。
4. 如果第一个子节点存在。
 1. 取出 `script` 并修改 `type` 将其禁用。 
 1. 为每个元素执行回调，进行插入操作。
 2. 如果存在 `script` 则进行合并。
 3. 最后一个不会进行 `clone`。
5. 如果存在 `script`。
 1. 那么将其恢复。
 2. 遍历 `script`。
     1. 如果存在 `src`，那么同步加载并执行。
     2. 否则就全局环境下执行 `script` 中的内容。   
6. 清空 `fragment`、`first` 防止内存泄漏。 

> 关于 `script` 前面也讲过，这里在啰嗦一下。`innerHTML` 转换 HTML 后的 script 元素不会自动加载和执行，因此这里做了手动地操作。

### 删除元素

### 复制元素

### 替换元素

### 包裹元素